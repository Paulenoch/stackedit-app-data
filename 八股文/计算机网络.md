# TCP/IP四层模型
1.  应用层：为计算机用户提供服务
2.  传输层：为两台主机进程间的通信提供通用的数据传输服务
3.  网络层：路由和寻址
4.  网络接口层：处理与物理网络介质的直接通信

### 为什么要设计四层模型
各层之间相互独立，提高了灵活性和可替换性

# 从输入URL到页面展示经历了哪些步骤
1. 输入URL
2. 浏览器根据DNS协议，获取域名对应的IP地址
3. 浏览器根据IP地址和端口号，向目标服务器发起一个TCP连接请求
4. 浏览器在TCP连接上，向服务器发起一个HTTP请求报文，请求获取网页内容
5. 服务器收到HTTP报文后，处理请求，并返回HTTP响应报文给浏览器
6. 浏览器收到HTTP响应报文后，解析请求，显示内容，
7. 不需要通信时，可主动关闭TCP连接

# HTTPS加密
SSL协议：非对称加密
使用非对称加密对密钥进行加密，后续使用该密钥进行对称加密

流程：
1. 服务端将公钥证书发送给客户端
2. 客户端验证服务器的证书
3. 验证通过，客户端生成一个用于会话的对称密钥
4. 客户端使用服务器的公钥对对称密钥进行加密，将加密后的密钥发给服务器
5. 服务器使用私钥对加密密钥解密，得到对称密钥
6. 后续使用对称密钥进行加密解密

# HTTP1.1
1. 支持长连接，缓存机制

# HTTP2.0
1. 多路复用
2. 二进制帧代替文本格式的报文进行数据传输
3. 服务器推送：可以在客户端请求一个资源时，将其他相关资源一并推送给客户端，从而减少了客户端的请求次数和延迟

# HTTP3.0
1. 基于QUIC（UDP），建立连接仅需0-RTT 或者 1-RTT

# WebSocket
WebSocket 是一种基于 TCP 连接的全双工通信协议，即客户端和服务器可以同时发送和接收数据。
WebSocket 协议本质上是应用层的协议，用于弥补 HTTP 协议在持久通信能力上的不足。客户端和服务器仅需一次握手，两者之间就直接可以创建持久性的连接，并进行双向数据传输。

# TCP/UDP区别
1. 是否面向连接
2. 是否可靠传输
3. 是否有状态
4. 传输效率
5. 传输形式：TCP面向字节流。UDP面向报文
6. 首部开销：TCP较大
7. UDP支持广播或多播

# 有了HTTP协议，为什么还需要RPC
RPC是C/S架构（Client/Server），软件只需要和自家公司的服务器连接（如杀毒软件）
HTTP是B/S架构（Browser/Server），不仅要访问自家服务器，也需要访问其他网站的服务器
RPC可以实现更高程度的定制化，比如消息头的自定义，序列化方式可以使用性能更好的ProtoBuf（Http是Json）

# 半连接队列和全连接队列
-   **半连接队列**（也称 SYN Queue）：当服务端收到客户端的 SYN 请求时，此时双方还没有完全建立连接，它会把半连接状态的连接放在半连接队列。
-   **全连接队列**（也称 Accept Queue）：当服务端收到客户端对 ACK 响应时，意味着三次握手成功完成，服务端会将该连接从半连接队列移动到全连接队列。如果未收到客户端的 ACK 响应，会进行重传，重传的等待时间通常是指数增长的。如果重传次数超过系统规定的最大重传次数，系统将从半连接队列中删除该连接信息。

# 四次挥手中为什么不能把服务端发送的ACK和FIN合并起来变成三次回收

因为服务端收到客户端断开连接的请求时，可能还有一些数据没有发完，这时先回复 ACK，表示接收到了断开连接的请求。等到数据发完之后再发 FIN，断开服务端到客户端的数据传送。

# 为什么第四次挥手客户端需要等待2*MSL时间后才进入CLOSED状态
原因一：
- 第四次挥手时，客户端发送给服务端的 ACK 有可能丢失，如果服务端因为某些原因而没有收到 ACK 的话，服务端就会重发 FIN，如果客户端在 2*MSL 的时间内收到了 FIN，就会重新发送 ACK 并再次等待 2MSL，防止 Server 没有收到 ACK 而不断重发 FIN。

原因二：确保“旧连接”中的报文不会影响“新连接”

-   如果客户端立刻释放端口，新建立的连接如果使用了同样的 4 元组（源 IP、源端口、目的 IP、目的端口），  
    网络中延迟的旧报文可能被新连接“误收”。
    
-   等待 2*MSL，可以保证**所有属于旧连接的报文都消失**，不会干扰新连接。

# TCP如何保证传输的可靠性
- 基于数据块传输
- 为了不丢包，给每个包一个序列号，通过序列号队收到的数据排序，并去掉序列号重复的数据包
- 校验和：TCP保持首部和数据的校验和，目的是检测数据在传输过程中是否有变化
- 重传机制
- 流量控制：TCP 连接的每一方都有固定大小的缓冲空间，TCP 的接收端只允许发送端发送接收端缓冲区能接纳的数据。当接收方来不及处理发送方的数据，能提示发送方降低发送的速率，防止包丢失。TCP 使用的流量控制协议是可变大小的滑动窗口协议（TCP 利用滑动窗口实现流量控制）。
1.  拥塞控制 : 当网络拥塞时，减少数据的发送。网络的拥塞程度由拥塞窗口表示，它是发送方根据网络状况自己维护的一个值，表示发送方认为可以在网络中传输的数据量。发送方发送数据的大小是滑动窗口和拥塞窗口的最小值，这样可以保证发送方既不会超过接收方的接收能力，也不会造成网络的过度拥塞。

# 流量控制的滑动窗口
![输入图片说明](/imgs/2025-05-26/DbmBElQmYamzmoHI.png)
![输入图片说明](/imgs/2025-05-26/QQ9hbgehJHIDB8rR.png)

# 拥塞控制
![输入图片说明](/imgs/2025-05-26/ORPNia9qMvbys5qp.png)
0-1：慢启动，cwnd（拥塞窗口）从 1 开始，每收到一个 ACK，cwnd 增加 1，即指数增长。
    
-   当 cwnd 增长到 ssthresh（慢开始门限）的初始值（比如这里是 16）时，进入“拥塞避免”。




<!--stackedit_data:
eyJoaXN0b3J5IjpbLTE0MzkwMTcxMTYsLTEwNTMwNTQ4NzYsLT
Q4NDQzNTA4Myw2NDMzODU4NTUsMjA1NDg5NjQ4MCwyMDIzNjc0
MTk1LDU5NzU2NDQwMywtMTUyOTUwNjYxOSw1OTIyODE5MTEsLT
E5MzExNDM0MTRdfQ==
-->