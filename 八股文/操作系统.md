# 什么是操作系统
-   操作系统本质上是一个运行在计算机上的软件程序 ，主要用于管理计算机硬件和软件资源。 举例：运行在你电脑上的所有应用程序都通过操作系统来调用系统内存以及磁盘等等硬件。
-   操作系统存在屏蔽了硬件层的复杂性。 操作系统就像是硬件使用的负责人，统筹着各种相关事项。
-   操作系统的内核（Kernel）是操作系统的核心部分，它负责系统的内存管理，硬件设备的管理，文件系统的管理以及应用程序的管理。 内核是连接应用程序和硬件的桥梁，决定着系统的性能和稳定性。

# 用户态和内核态
- 用户态的进程可以直接读取用户程序的数据，权限较低。当需要执行需要权限的特殊操作时（读写磁盘，网络通信），就需要向操作系统发起系统调用请求，进入内核态。
- 内核态运行的进程几乎可以访问计算机的任何资源包括系统的内存空间、设备、驱动程序等，不受限制，拥有非常高的权限。当操作系统接收到进程的系统调用请求时，就会从用户态切换到内核态，执行相应的系统调用，并将结果返回给进程，最后再从内核态切换回用户态。

进入内核态需要付出较高的开销（需要进行一系列的上下文切换和权限检查），应该尽量减少进入内核态的次数，以提高系统的性能和稳定性。

### 为什么要区分用户态和内核态
对于一些危险的指令如内存分配，设置时钟等，若所有程序都可以无条件操作的话对系统的稳定性会有极大影响
如果只有内核态，所有的程序和进程都需要共享系统资源导致竞争和冲突

### 用户态切换到内核态的三种方式
-   **系统调用（Trap）**：用户态进程 **主动** 要求切换到内核态的一种方式，主要是为了使用内核态才能做的事情比如读取磁盘资源。系统调用的机制其核心还是使用了操作系统为用户特别开放的一个中断来实现。
-   **中断（Interrupt）**：当外围设备完成用户请求的操作后，会向 CPU 发出相应的中断信号，这时 CPU 会暂停执行下一条即将要执行的指令转而去执行与中断信号对应的处理程序，如果先前执行的指令是用户态下的程序，那么这个转换的过程自然也就发生了由用户态到内核态的切换。比如硬盘读写操作完成，系统会切换到硬盘读写的中断处理程序中执行后续操作等。
-   **异常（Exception）**：当 CPU 在执行运行在用户态下的程序时，发生了某些事先不可知的异常，这时会触发由当前运行进程切换到处理此异常的内核相关程序中，也就转到了内核态，比如缺页异常。

### 系统调用的过程
1. 用户态的程序发起系统调用，由于涉及特权指令，用户态权限不足，因此会中断执行，也就是Trap（Trap是一种中断）
2. 
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTE2OTc1MjA1NDIsLTUyMjQxNTkxOSwtNz
k0ODIzODk0LC0xNTAxMDY1MDM5LC0yMDg4NzQ2NjEyXX0=
-->