# 抽奖接口draw
1. 创建抽奖订单 (`createOrder`): 
-    为用户创建一张抽奖单。检查活动状态和是或否再活动日期内
- 查询是否有状态为created（创建了但未被使用）的订单
- 检查用户是否有足够的抽奖次数（日账户或月账户若不存在则创建），并返回账户构建对象（聚合对象）
- 将订单实体填充进账户构建对象中
- 根据user_id进行分库分表路由，在一个事务中更新总/日/月账户，写入参与活动订单，更新失败则回滚

 ---
    
2. 执行抽奖策略 (`performRaffle`)**: 拿到抽奖单后，调用`raffleStrategy`来执行核心的抽奖算法，决定用户中了什么奖。
    
-   **保存中奖记录 (`saveUserAwardRecord`)**: 抽奖成功后，调用`awardService`将中奖记录保存到数据库。

# 接口限流实现细节
1. 定义限流注解@RateLimiterAccessInterceptor
-   `key()`: 用于指定限流的依据。比如，在抽奖接口中，我们希望对每个用户进行限流，那么就可以将`key`设置为`"userId"`。AOP会从请求参数中获取`userId`的值，并为每个`userId`创建一个独立的限流器。
    
-   `permitsPerSecond()`: 这是核心的限流参数，表示**每秒允许的请求次数**。例如，设置为`1.0d`就表示每秒只允许1次请求。
    
-   `blacklistCount()`: 黑名单阈值。如果一个用户在被限流后仍然持续请求，当被拦截的次数超过这个阈值时，该用户就会被加入黑名单（默认24小时），后续所有请求都会被直接拒绝。
    
-   `fallbackMethod()`: 降级方法。当请求被限流时，程序会调用这个指定的方法来返回一个友好的提示，而不是直接报错。
<!--stackedit_data:
eyJoaXN0b3J5IjpbOTc1MjM0NTI0LDE1NjkxMTM3NjFdfQ==
-->